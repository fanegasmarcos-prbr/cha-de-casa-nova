<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Presentes do Novo Lar (Compartilhada)</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #4CAF50;
            margin-bottom: 5px;
        }
        h2 {
            color: #555;
            font-size: 1.2em;
            margin-top: 0;
            margin-bottom: 30px;
        }
        /* Estilos para as Categorias */
        .category-title {
            color: #2F8D34; /* Um verde um pouco mais escuro para destaque */
            font-size: 1.5em;
            margin-top: 40px;
            margin-bottom: 15px;
            border-bottom: 2px solid #D4EDDA; /* Linha sutil abaixo do t√≠tulo da categoria */
            padding-bottom: 5px;
            text-align: left;
        }
        .item-list {
            list-style: none;
            padding: 0;
            text-align: left;
            margin-bottom: 30px;
        }
        .item {
            display: flex;
            align-items: center;
            padding: 10px 0; /* Padding um pouco menor para mais itens */
            border-bottom: 1px dashed #eee; /* Borda tracejada para separar melhor */
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.95em; /* Fonte um pouco menor */
        }
        .item:last-child {
            border-bottom: none; /* Remove a borda do √∫ltimo item da lista */
        }
        .item:hover:not(.reserved) {
            background-color: #f9f9f9;
        }
        /* Estilo para item selecionado */
        .item.selected:not(.reserved) {
            background-color: #e6ffe6;
        }
        /* Estilo para item RESERVADO */
        .item.reserved {
            cursor: default;
        }
        .item.reserved .item-name {
            text-decoration: line-through;
            color: #888;
            font-style: italic;
        }
        .item.reserved .reserved-by {
            font-size: 0.75em; /* Fonte um pouco menor para o nome do reservador */
            color: #555;
            margin-left: 10px;
        }
        .item-checkbox {
            margin-right: 15px;
            transform: scale(1.3); /* Tamanho do checkbox */
        }
        .item-name {
            font-weight: bold;
            flex-grow: 1;
        }
        .input-group {
            margin-top: 20px;
            margin-bottom: 20px;
            text-align: left;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input[type="text"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }
        .button-save {
            background-color: #4CAF50;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s;
        }
        .button-save:hover {
            background-color: #45a049;
        }
        .message {
            margin-top: 20px;
            color: #f44336;
            font-weight: bold;
        }
        .loading {
            color: #4CAF50;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Nosso Ch√° de Casa Nova! ü•Ç</h1>
        <h2>Escolha um presente para nos ajudar a montar nosso novo lar.</h2>

        <div id="loading-message" class="loading">Carregando lista...</div>

        <div id="gift-sections" style="display:none;">
            
            <h3 class="category-title">COZINHA</h3>
            <ul id="gift-list-cozinha" class="item-list">
                <li class="item" data-id="c01" data-name="Abridor">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Abridor</span>
                </li>
                <li class="item" data-id="c02" data-name="Afiador de Faca">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Afiador de Faca</span>
                </li>
                <li class="item" data-id="c03" data-name="Amassador de Alho">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Amassador de Alho</span>
                </li>
                <li class="item" data-id="c04" data-name="Assadeiras (Redon, Retan, Pudim, Pizza)">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Assadeiras (Redon, Retan, Pudim, Pizza)</span>
                </li>
                <li class="item" data-id="c05" data-name="Boleira">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Boleira</span>
                </li>
                <li class="item" data-id="c06" data-name="Bule (Chaleira)">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Bule (Chaleira)</span>
                </li>
                <li class="item" data-id="c07" data-name="Coador de Caf√©">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Coador de Caf√©</span>
                </li>
                <li class="item" data-id="c08" data-name="Colher de Pau">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Colher de Pau</span>
                </li>
                <li class="item" data-id="c09" data-name="Escorredor de Lou√ßa">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Escorredor de Lou√ßa</span>
                </li>
                <li class="item" data-id="c10" data-name="Escorredor de Macarr√£o">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Escorredor de Macarr√£o</span>
                </li>
                <li class="item" data-id="c11" data-name="Esp√°tula de Margarina">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Esp√°tula de Margarina</span>
                </li>
                <li class="item" data-id="c12" data-name="Formas de Gelo">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Formas de Gelo</span>
                </li>
                <li class="item" data-id="c13" data-name="Funil">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Funil</span>
                </li>
                <li class="item" data-id="c14" data-name="Garrafa de Caf√©">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Garrafa de Caf√©</span>
                </li>
                <li class="item" data-id="c15" data-name="Jarra">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Jarra</span>
                </li>
                <li class="item" data-id="c16" data-name="Jogo Americano (Mesa)">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Jogo Americano (Mesa)</span>
                </li>
                <li class="item" data-id="c17" data-name="Jogo de Copos">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Jogo de Copos</span>
                </li>
                <li class="item" data-id="c18" data-name="Jogo de Jantar">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Jogo de Jantar</span>
                </li>
                <li class="item" data-id="c19" data-name="Jogo de Panela">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Jogo de Panela</span>
                </li>
                <li class="item" data-id="c20" data-name="Jogo de Pratos">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Jogo de Pratos</span>
                </li>
                <li class="item" data-id="c21" data-name="Jogo de Sobremesa">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Jogo de Sobremesa</span>
                </li>
                <li class="item" data-id="c22" data-name="Jogo de Ta√ßas">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Jogo de Ta√ßas</span>
                </li>
                <li class="item" data-id="c23" data-name="Jogo de Talheres">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Jogo de Talheres</span>
                </li>
                <li class="item" data-id="c24" data-name="Jogo de X√≠caras">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Jogo de X√≠caras</span>
                </li>
                <li class="item" data-id="c25" data-name="Kit de Canec√£os">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Kit de Canec√£os</span>
                </li>
                <li class="item" data-id="c26" data-name="Kit de Faca">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Kit de Faca</span>
                </li>
                <li class="item" data-id="c27" data-name="Kit Frigideiras">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Kit Frigideiras</span>
                </li>
                <li class="item" data-id="c28" data-name="Kit de Peneiras">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Kit de Peneiras</span>
                </li>
                <li class="item" data-id="c29" data-name="Kit de Pia (Lixo, Rodo, etc)">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Kit de Pia (Lixo, Rodo, etc)</span>
                </li>
                <li class="item" data-id="c30" data-name="Kit de Talheres Utens√≠lios">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Kit de Talheres Utens√≠lios</span>
                </li>
                <li class="item" data-id="c31" data-name="Luva T√©rmica">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Luva T√©rmica</span>
                </li>
                <li class="item" data-id="c32" data-name="Marinex (Travessas)">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Marinex (Travessas)</span>
                </li>
                <li class="item" data-id="c33" data-name="Medidores (Copo, etc)">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Medidores (Copo, etc)</span>
                </li>
                <li class="item" data-id="c34" data-name="Panela de Press√£o">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Panela de Press√£o</span>
                </li>
                <li class="item" data-id="c35" data-name="Panos de Prato">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Panos de Prato</span>
                </li>
                <li class="item" data-id="c36" data-name="Pegador de Sorvete">
                    <input type type="checkbox" class="item-checkbox">
                    <span class="item-name">Pegador de Sorvete</span>
                </li>
                <li class="item" data-id="c37" data-name="Pipoqueira">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Pipoqueira</span>
                </li>
                <li class="item" data-id="c38" data-name="Porta Ovos">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Porta Ovos</span>
                </li>
                <li class="item" data-id="c39" data-name="Porta Temperos">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Porta Temperos</span>
                </li>
                <li class="item" data-id="c40" data-name="Pote de Arroz, etc....">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Pote de Arroz, etc....</span>
                </li>
                <li class="item" data-id="c41" data-name="Potes Herm√©ticos Amazon">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Potes Herm√©ticos Amazon</span>
                </li>
                <li class="item" data-id="c42" data-name="Ralador">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Ralador</span>
                </li>
                <li class="item" data-id="c43" data-name="Rolo">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Rolo</span>
                </li>
                <li class="item" data-id="c44" data-name="Saleiro">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Saleiro</span>
                </li>
                <li class="item" data-id="c45" data-name="Suporte Papel Toalha">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Suporte Papel Toalha</span>
                </li>
                <li class="item" data-id="c46" data-name="T√°bua de Carne">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">T√°bua de Carne</span>
                </li>
                <li class="item" data-id="c47" data-name="Tigelas (Bowls)">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Tigelas (Bowls)</span>
                </li>
            </ul>

            <h3 class="category-title">ELETRODOM√âSTICOS</h3>
            <ul id="gift-list-eletrodomesticos" class="item-list">
                <li class="item" data-id="e01" data-name="Aspirador">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Aspirador</span>
                </li>
                <li class="item" data-id="e02" data-name="Airfryer">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Airfryer</span>
                </li>
                <li class="item" data-id="e03" data-name="Batedeira">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Batedeira</span>
                </li>
                <li class="item" data-id="e04" data-name="Cafeteira">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Cafeteira</span>
                </li>
                <li class="item" data-id="e05" data-name="Ferro">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Ferro</span>
                </li>
                <li class="item" data-id="e06" data-name="Liquidificador">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Liquidificador</span>
                </li>
                <li class="item" data-id="e07" data-name="Micro Ondas">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Micro Ondas</span>
                </li>
                <li class="item" data-id="e08" data-name="Mini Processador">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Mini Processador</span>
                </li>
                <li class="item" data-id="e09" data-name="Mixer">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Mixer</span>
                </li>
                <li class="item" data-id="e10" data-name="Multiprocessador">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Multiprocessador</span>
                </li>
                <li class="item" data-id="e11" data-name="Sanduicheira">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Sanduicheira</span>
                </li>
            </ul>

            <h3 class="category-title">CAMA, MESA E BANHO</h3>
            <ul id="gift-list-cama-mesa-banho" class="item-list">
                <li class="item" data-id="cmb01" data-name="Almofadas">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Almofadas</span>
                </li>
                <li class="item" data-id="cmb02" data-name="Cortinas">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Cortinas</span>
                </li>
                <li class="item" data-id="cmb03" data-name="Edredom">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Edredom</span>
                </li>
                <li class="item" data-id="cmb04" data-name="Len√ßol e Fronha">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Len√ßol e Fronha</span>
                </li>
                <li class="item" data-id="cmb05" data-name="Passadeira">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Passadeira</span>
                </li>
                <li class="item" data-id="cmb06" data-name="Tapetes">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Tapetes</span>
                </li>
                <li class="item" data-id="cmb07" data-name="Tapetes de Banheiro">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Tapetes de Banheiro</span>
                </li>
                <li class="item" data-id="cmb08" data-name="Toalhas">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Toalhas</span>
                </li>
                <li class="item" data-id="cmb09" data-name="Toalha de Mesa">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Toalha de Mesa</span>
                </li>
                <li class="item" data-id="cmb10" data-name="Toalha de Rosto">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Toalha de Rosto</span>
                </li>
                <li class="item" data-id="cmb11" data-name="Travesseiros">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Travesseiros</span>
                </li>
            </ul>

            <h3 class="category-title">BANHEIRO</h3>
            <ul id="gift-list-banheiro" class="item-list">
                <li class="item" data-id="b01" data-name="Escova de Privada">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Escova de Privada</span>
                </li>
                <li class="item" data-id="b02" data-name="Kit de Banheiro">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Kit de Banheiro</span>
                </li>
                <li class="item" data-id="b03" data-name="Lixo de Banheiro">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Lixo de Banheiro</span>
                </li>
                <li class="item" data-id="b04" data-name="Tapetes">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Tapetes</span>
                </li>
            </ul>

            <h3 class="category-title">√ÅREA DE SERVI√áO</h3>
            <ul id="gift-list-area-servico" class="item-list">
                <li class="item" data-id="as01" data-name="Bacias">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Bacias</span>
                </li>
                <li class="item" data-id="as02" data-name="Baldes">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Baldes</span>
                </li>
                <li class="item" data-id="as03" data-name="P√°, Vassoura, Rodo">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">P√°, Vassoura, Rodo</span>
                </li>
                <li class="item" data-id="as04" data-name="Panos de Ch√£o">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Panos de Ch√£o</span>
                </li>
                <li class="item" data-id="as05" data-name="Panos de Microfibra">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Panos de Microfibra</span>
                </li>
                <li class="item" data-id="as06" data-name="Prendedores">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Prendedores</span>
                </li>
                <li class="item" data-id="as07" data-name="Varal de Calcinhas">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Varal de Calcinhas</span>
                </li>
                <li class="item" data-id="as08" data-name="Moop">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Moop</span>
                </li>
            </ul>

            <h3 class="category-title">OUTROS</h3>
            <ul id="gift-list-outros" class="item-list">
                <li class="item" data-id="o01" data-name="Caixa Organizadora">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Caixa Organizadora</span>
                </li>
                <li class="item" data-id="o02" data-name="Extens√£o">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Extens√£o</span>
                </li>
                <li class="item" data-id="o03" data-name="Kit de Ferramentas">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Kit de Ferramentas</span>
                </li>
                <li class="item" data-id="o04" data-name="Mangueira">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Mangueira</span>
                </li>
                <li class="item" data-id="o05" data-name="T√°bua de Passar Roupa">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">T√°bua de Passar Roupa</span>
                </li>
                <li class="item" data-id="o06" data-name="Organizador de Gaveta">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Organizador de Gaveta</span>
                </li>
                <li class="item" data-id="o07" data-name="Organizador Talheres">
                    <input type="checkbox" class="item-checkbox">
                    <span class="item-name">Organizador Talheres</span>
                </li>
            </ul>
        </div> 

        <div id="reservation-form">
            <div class="input-group">
                <label for="guest-name">Seu Nome:</label>
                <input type="text" id="guest-name" placeholder="Digite seu nome completo">
            </div>

            <button id="save-button" class="button-save">Marcar Presente</button>
        </div>

        <p id="feedback-message" class="message"></p>
    </div>

    <script>
        // ===================================================================
        // üîë CREDENCIAIS DO JSONBIN.IO - MANTIDAS
        // ===================================================================
        const JSONBIN_API_KEY = '$2a$10$id6BPYs5ZTvHYHJ9WU/Jx.dQGhtDo0W0owelrC0fEBW7dOHSQsAEe'; // Sua Master Key
        const JSONBIN_BIN_ID = '6924a143d0ea881f40fd8c56';     // Seu Bin ID
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;
        // ===================================================================

        const saveButton = document.getElementById('save-button');
        const guestNameInput = document.getElementById('guest-name');
        const feedbackMessage = document.getElementById('feedback-message');
        const loadingMessage = document.getElementById('loading-message');
        const giftSections = document.getElementById('gift-sections'); 

        let reservedGifts = []; 
        let selectedGiftId = null; 

        // 1. CARREGAR DADOS DO JSONBIN
        async function fetchReservedGifts() {
            try {
                const response = await fetch(JSONBIN_URL, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY
                    }
                });

                if (!response.ok) {
                    throw new Error('Erro ao carregar lista. Status: ' + response.status);
                }

                const data = await response.json();
                reservedGifts = data.record.reserved_gifts || []; 
                
                updateUI();
            } catch (error) {
                console.error('Erro de persist√™ncia:', error);
                feedbackMessage.textContent = 'Erro ao carregar a lista de presentes. Tente novamente mais tarde.';
                feedbackMessage.style.color = '#f44336';
            } finally {
                // Independentemente do sucesso ou falha, mostramos o container de presentes
                loadingMessage.style.display = 'none'; 
                giftSections.style.display = 'block'; 
            }
        }

        // 2. ATUALIZAR INTERFACE DO USU√ÅRIO (riscar itens)
        function updateUI() {
            const allItems = document.querySelectorAll('.item-list .item'); // Seleciona todos os itens em todas as listas
            
            allItems.forEach(item => {
                const itemId = item.dataset.id;
                const reservation = reservedGifts.find(rg => rg.id === itemId);

                if (reservation) {
                    item.classList.add('reserved');
                    item.classList.remove('selected');
                    item.querySelector('.item-checkbox').checked = true;
                    item.querySelector('.item-checkbox').disabled = true;

                    let reservedBySpan = item.querySelector('.reserved-by');
                    if (!reservedBySpan) {
                         reservedBySpan = document.createElement('span');
                         reservedBySpan.classList.add('reserved-by');
                         item.appendChild(reservedBySpan);
                    }
                    reservedBySpan.textContent = `(Reservado por: ${reservation.name})`;

                } else {
                    item.classList.remove('reserved');
                    item.querySelector('.item-checkbox').disabled = false;
                    const reservedBySpan = item.querySelector('.reserved-by');
                    if (reservedBySpan) {
                        reservedBySpan.remove();
                    }
                }
            });
        }

        // 3. SALVAR NOVOS DADOS NO JSONBIN
        async function saveReservedGift(newReservation) {
            reservedGifts.push(newReservation);
            
            const dataToSave = {
                reserved_gifts: reservedGifts
            };

            try {
                const response = await fetch(JSONBIN_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify(dataToSave) 
                });

                if (!response.ok) {
                    throw new Error('Falha ao salvar a reserva. Status: ' + response.status);
                }

                updateUI();
                feedbackMessage.textContent = `Obrigado, ${newReservation.name}! Seu presente "${newReservation.item}" foi marcado com sucesso para todos os convidados.`;
                feedbackMessage.style.color = '#4CAF50';
                
            } catch (error) {
                console.error('Erro ao salvar:', error);
                reservedGifts.pop(); 
                feedbackMessage.textContent = 'Erro ao salvar. Verifique a conex√£o ou tente novamente.';
                feedbackMessage.style.color = '#f44336';
            }
        }

        // Event Listeners ==================================================

        // Listener para sele√ß√£o de item
        giftSections.addEventListener('click', function(event) {
            const clickedItem = event.target.closest('.item');
            if (!clickedItem || clickedItem.classList.contains('reserved')) {
                return; 
            }
            
            const previousSelected = document.querySelector('.item.selected');
            if (previousSelected && previousSelected !== clickedItem) {
                previousSelected.classList.remove('selected');
                previousSelected.querySelector('.item-checkbox').checked = false;
            }

            clickedItem.classList.toggle('selected');
            const checkbox = clickedItem.querySelector('.item-checkbox');
            checkbox.checked = clickedItem.classList.contains('selected');

            selectedGiftId = clickedItem.classList.contains('selected') ? clickedItem.dataset.id : null;
        });

        // Listener para o bot√£o de salvar
        saveButton.addEventListener('click', async function() {
            const name = guestNameInput.value.trim();

            if (!selectedGiftId) {
                feedbackMessage.textContent = 'Por favor, selecione um presente na lista.';
                feedbackMessage.style.color = '#f44336';
                return;
            }

            if (!name) {
                feedbackMessage.textContent = 'Por favor, digite seu nome.';
                feedbackMessage.style.color = '#f44336';
                return;
            }
            
            const giftElement = document.querySelector(`.item[data-id="${selectedGiftId}"]`);
            const newReservation = {
                id: selectedGiftId,
                name: name,
                item: giftElement.dataset.name,
                date: new Date().toISOString()
            };

            saveButton.disabled = true; 
            feedbackMessage.textContent = 'Reservando presente, aguarde...';
            
            await saveReservedGift(newReservation);
            
            guestNameInput.value = '';
            selectedGiftId = null;
            saveButton.disabled = false;
        });

        // INICIA O CARREGAMENTO DA LISTA
        fetchReservedGifts();
    </script>
</body>
</html>
